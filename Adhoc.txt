-- Question 1.
SELECT DISTINCT product_name, category, base_price
FROM dim_products
JOIN fact_events ON dim_products.product_code = fact_events.product_code
WHERE promo_type = 'BOGOF' AND base_price > 500;


-- Question 2.
SELECT city, COUNT(DISTINCT store_id) AS store_count
FROM dim_stores
GROUP BY city
ORDER BY store_count DESC;


-- Question 3.
SELECT     c.campaign_name,     
CONCAT(ROUND(SUM(fe.`quantity_sold(before_promo)` * fe.base_price) / 1000000, 0), ' M') AS total_rev_before_promo_in_millions,     
CONCAT(ROUND(SUM(fe.`quantity_sold(after_promo)` * fe.base_price) / 1000000, 0), ' M') AS total_rev_after_promo_in_millionsFROM     
fact_events fe
JOIN     
dim_campaigns c 
ON fe.campaign_id = c.campaign_idGROUP BY     c.campaign_nameORDER BY     total_rev_before_promo_in_millions DESC,     total_rev_after_promo_in_millions DESC;


-- Question 4.

WITH ISU AS (
    SELECT 
        dp.category,
        ROUND(((SUM(fe.`quantity_sold(after_promo)`) - SUM(fe.`quantity_sold(before_promo)`)) / SUM(fe.`quantity_sold(before_promo)`)) * 100 , 2) AS ISU_percentage
    FROM 
        dim_products dp
    JOIN 
        fact_events fe ON dp.product_code = fe.product_code
        JOIN dim_campaigns c
        ON fe.campaign_id = c.campaign_id
        WHERE c.campaign_name = 'Diwali'
    GROUP BY dp.category
    
)
SELECT 
    *, RANK() OVER (ORDER BY ISU_percentage DESC) AS ISU_Rank
FROM  ISU;

-- Question 5

    SELECT 
    p.product_name, 
    p.category, 
    CONCAT(ROUND(((SUM(fe.`quantity_sold(after_promo)`* base_price) - SUM(fe.`quantity_sold(before_promo)`* base_price)) / SUM(fe.`quantity_sold(before_promo)`* base_price) * 100), 2), " %") as IR_percentage
FROM 
    fact_events AS fe
JOIN 
    dim_products AS p ON fe.product_code = p.product_code
GROUP BY 
    p.product_name, p.category 
ORDER BY 
        ((SUM(fe.`quantity_sold(after_promo)`* base_price) - SUM(fe.`quantity_sold(before_promo)`* base_price)) / 
        SUM(fe.`quantity_sold(before_promo)`* base_price) * 100)  DESC
limit 5 ;
